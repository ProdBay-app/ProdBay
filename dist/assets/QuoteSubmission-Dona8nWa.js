import{e as D,u as k,r as i,j as e,F as P,P as j,d as Q,B as F,D as E,b as T}from"./index-20u6XjU9.js";import{s as g}from"./supabase-DvtyvoWz.js";import{S as B}from"./send-BrhAhsbE.js";const R=()=>{var x,h,p;const{token:c}=D(),b=k(),[o,f]=i.useState(null),[a,y]=i.useState(null),[l,N]=i.useState(null),[r,n]=i.useState({cost:0,notes_capacity:""}),[v,w]=i.useState(!0),[d,m]=i.useState(!1),[S,u]=i.useState(!1),_=()=>{b("/")};i.useEffect(()=>{c&&q()},[c]);const q=async()=>{try{const{data:s,error:t}=await g.from("quotes").select(`
          *,
          supplier:suppliers(*),
          asset:assets(
            *,
            project:projects(*)
          )
        `).eq("quote_token",c).single();if(t||!s){console.error("Quote not found:",t);return}f(s),y(s.asset),N(s.supplier),(s.cost>0||s.notes_capacity)&&n({cost:s.cost||0,notes_capacity:s.notes_capacity||""}),s.cost>0&&s.status==="Submitted"&&u(!0)}catch(s){console.error("Error loading quote data:",s)}finally{w(!1)}},C=async s=>{s.preventDefault(),m(!0);try{const{error:t}=await g.from("quotes").update({cost:r.cost,notes_capacity:r.notes_capacity,status:"Submitted"}).eq("id",o.id);if(t)throw t;u(!0),alert("Quote submitted successfully!")}catch(t){console.error("Error submitting quote:",t),alert("Failed to submit quote. Please try again.")}finally{m(!1)}};return v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):!o||!a||!l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Quote Not Found"}),e.jsx("p",{className:"text-gray-600",children:"This quote request may have expired or the link may be invalid."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-orange-600 text-white shadow-lg",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer hover:opacity-80 transition-opacity",onClick:_,title:"Go to Home",children:[e.jsx(j,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ProdBay Quote Request"}),e.jsx("p",{className:"opacity-90",children:"Supplier Portal"})]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:S?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-green-500 mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Quote Submitted Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Thank you for your quote. The producer will review your submission and contact you if your quote is selected."}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Your Quote Summary:"}),e.jsxs("div",{className:"text-left space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cost:"})," $",r.cost.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Asset:"})," ",a.asset_name]}),r.notes_capacity&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",r.notes_capacity]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(F,{className:"h-6 w-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Project Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Project Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Project:"})," ",(x=a.project)==null?void 0:x.project_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",(h=a.project)==null?void 0:h.client_name]}),a.timeline&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Deadline:"})," ",new Date(a.timeline).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Your Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Company:"})," ",l.supplier_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",l.contact_email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Categories:"})," ",l.service_categories.join(", ")]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(j,{className:"h-6 w-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Asset Requirements"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:a.asset_name}),e.jsx("p",{className:"text-gray-700 mb-4",children:a.specifications}),((p=a.project)==null?void 0:p.brief_description)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Project Brief Context:"}),e.jsx("p",{className:"text-gray-700 text-sm",children:a.project.brief_description})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(E,{className:"h-6 w-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Submit Your Quote"})]}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cost",className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Cost *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",id:"cost",value:r.cost||"",onChange:s=>n(t=>({...t,cost:parseFloat(s.target.value)||0})),required:!0,min:"0",step:"0.01",className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes_capacity",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes & Capacity Details"}),e.jsx("textarea",{id:"notes_capacity",value:r.notes_capacity,onChange:s=>n(t=>({...t,notes_capacity:s.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Include details about your capacity, timeline, terms, special requirements, or any other relevant information..."})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("button",{type:"submit",disabled:d||r.cost<=0,className:"flex items-center space-x-2 px-8 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:d?"Submitting...":"Submit Quote"})]})})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(T,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Important Information:"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• Please provide your best competitive pricing"}),e.jsx("li",{children:"• Include all costs (materials, labor, delivery, etc.)"}),e.jsx("li",{children:"• Specify any terms or conditions in the notes section"}),e.jsx("li",{children:"• The producer will review all quotes and contact selected suppliers"})]})]})]})})]})})]})};export{R as default};
