import{c as D,a as S,r as l,j as e,C as A,P as k,D as I,b as p,d as E}from"./index-20u6XjU9.js";import{s as m}from"./supabase-DvtyvoWz.js";import{C as $}from"./circle-x-BZwSVlFQ.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Q=D("circle-alert",q),M=()=>{const[g]=S(),[r,j]=l.useState([]),[a,n]=l.useState(null),[c,N]=l.useState([]),[x,f]=l.useState([]),[b,y]=l.useState(!0),i=g.get("project");l.useEffect(()=>{w()},[]),l.useEffect(()=>{if(i&&r.length>0){const s=r.find(t=>t.id===i);s&&(n(s),o(i))}else r.length>0&&!a&&(n(r[0]),o(r[0].id))},[i,r]);const w=async()=>{try{const{data:s,error:t}=await m.from("projects").select("*").order("created_at",{ascending:!1});if(t)throw t;j(s||[])}catch(s){console.error("Error loading projects:",s)}finally{y(!1)}},o=async s=>{try{const{data:t}=await m.from("assets").select(`
          *,
          assigned_supplier:suppliers(*)
        `).eq("project_id",s);if(N(t||[]),t&&t.length>0){const d=t.map(C=>C.id),{data:_}=await m.from("quotes").select(`
            *,
            supplier:suppliers(*),
            asset:assets(*)
          `).in("asset_id",d);f(_||[])}}catch(t){console.error("Error loading project details:",t)}},h=s=>{switch(s){case"Completed":case"Delivered":case"Approved":return e.jsx(E,{className:"h-5 w-5 text-green-500"});case"In Progress":case"In Production":case"Quoting":return e.jsx(p,{className:"h-5 w-5 text-yellow-500"});case"Cancelled":return e.jsx($,{className:"h-5 w-5 text-red-500"});default:return e.jsx(Q,{className:"h-5 w-5 text-gray-500"})}},u=s=>{switch(s){case"Completed":case"Delivered":case"Approved":return"bg-green-100 text-green-800";case"In Progress":case"In Production":case"Quoting":return"bg-yellow-100 text-yellow-800";case"Cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=()=>x.filter(s=>s.status==="Accepted").reduce((s,t)=>s+(t.cost||0),0),P=()=>{if(c.length===0)return 0;const s=c.filter(t=>t.status==="Delivered").length;return Math.round(s/c.length*100)};return b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Project Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor your project progress and costs"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Your Projects"}),e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{onClick:()=>{n(s),o(s.id)},className:`p-4 rounded-lg border cursor-pointer transition-colors ${(a==null?void 0:a.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.project_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.client_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h(s.project_status),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(s.project_status)}`,children:s.project_status})]})]})},s.id))})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[P(),"%"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Assets"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["$",v().toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Deadline"}),e.jsx("p",{className:"text-sm font-medium text-orange-600",children:a.timeline_deadline?new Date(a.timeline_deadline).toLocaleDateString():"Not set"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Project Brief"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.brief_description}),a.physical_parameters&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Physical Parameters"}),e.jsx("p",{className:"text-gray-600",children:a.physical_parameters})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Asset Status"}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.asset_name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h(s.status),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(s.status)}`,children:s.status})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.specifications}),s.assigned_supplier&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Assigned to:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:s.assigned_supplier.supplier_name})]}),(()=>{const t=x.find(d=>d.asset_id===s.id&&d.status==="Accepted");return t?e.jsxs("div",{className:"text-sm mt-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cost:"}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:["$",t.cost.toFixed(2)]})]}):null})()]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Producer Notes"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-gray-700 italic",children:"Project is being processed. Your assigned producer will update this section with progress notes and any important updates."})})]})]})]})};export{M as default};
